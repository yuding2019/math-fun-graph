const q=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerpolicy&&(i.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?i.credentials="include":t.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=o(t);fetch(t.href,i)}};q();function P(e,r,o){return e.addEventListener(r,o),()=>{e.removeEventListener(r,o)}}const C={};function R(e,r){const o=C[e];return typeof o=="undefined"?C[e]=[r]:o.push(r),function(){const t=(o==null?void 0:o.slice())||[];for(let i=0;i<t.length;i++)if(t[i]===r)return o==null||o.splice(i,1),!0;return!1}}function X(e,r){const o=C[e];typeof o!="undefined"&&o.slice().forEach(n=>n(r))}var y={on:R,emit:X};const s={Y:"y",Equal:"=",X:"x",Plus:"+",Minus:"-",Multiply:"\xD7",Divide:"\xF7",Divide2:"/",Power:"^",Sqrt:"\u221A",Left:"(",Right:")",Dot:"."},w=/\-?[0-9]+/,_=/[\+\-\×\÷\^\√\(\)\/]/,I=[];function V(e,r){let o="";I.push(P(e,"click",()=>{const n=r.value;n!==o&&(o=n,y.emit("confirm:exp",n))}))}const W=Array.from({length:10},(e,r)=>String(r));function G(e,r){const o=[...Object.keys(s).map(n=>s[n]),...W].reduce((n,t)=>n+`
      <li class="item" value="${t}">${t}</li>
    `,"");e.innerHTML=o,I.push(P(e,"click",n=>{n.stopPropagation();const{target:t}=n;if(t===null||t.tagName.toLowerCase()!=="li")return;const i=t.textContent;r.value+=i}))}function Y(){const e=document.getElementById("expression"),r=document.getElementById("confirm"),o=document.getElementById("operator-wrapper");V(r,e),G(o,e)}function A(e,r){return{type:e,value:r,left:null,right:null}}function O(e){if(e.length===1){const n=e[0];return A(n==="x"?"var":"number",n)}const r=[...e];if(e.includes(s.Left)){const n=e.indexOf(s.Left),t=e.lastIndexOf(s.Right);r.splice(n,t-n+1,O(e.slice(n+1,t)))}const o=n=>{const t=r[n],i=r[n-1],u=r[n+1],f=A("operator",t);return f.right=typeof u=="object"?u:A(w.test(u)?"number":"var",u),t===s.Sqrt?(r.splice(n,2,f),f):(f.left=typeof i=="object"?i:A(w.test(i)?"number":"var",i),r.splice(n-1,3,f),f)};for(;r.length!==1;){let n=r.findIndex(t=>typeof t=="string"&&[s.Power,s.Sqrt].includes(t));if(n>=0){o(n);continue}if(n=r.findIndex(t=>typeof t=="string"&&[s.Multiply,s.Divide,s.Divide2].includes(t)),n>0){o(n);continue}n=r.findIndex(t=>typeof t=="string"&&[s.Plus,s.Minus].includes(t)),n>0&&o(n)}return r[0]}function j(e){const[r,o,...n]=e.split("=").map(d=>d.trim());if(!o)throw new Error("\u8868\u8FBE\u5F0F\u662F\u4E0D\u662F\u6CA1\u5199\u51FD\u6570\u4F53\u5440");if(n.length)throw new Error("\u8868\u8FBE\u5F0F\u662F\u4E0D\u662F\u591A\u4E86\u51E0\u4E2A\u7B49\u53F7\u5440");let t="";const i=[],u=[];for(let d=0;d<o.length;d++){const a=o[d];if(a!==" "){if(d===0&&a===s.Minus){const g=o[d+1];[s.X,s.Sqrt].includes(g)?i.push("-1",s.Multiply):w.test(g)&&(t+=a);continue}if(d===0&&w.test(o[d+1])||a===s.Dot||w.test(a)){t+=a;continue}if([s.X,s.Left].includes(a)){t&&(i.push(t,s.Multiply),t=""),i.push(a),a===s.Left&&u.push(s.Right);continue}_.test(a)&&(t&&(i.push(t),t=""),i.push(a),a===s.Right&&u.pop())}}if(t&&i.push(t),u.length)throw new Error("\u62EC\u53F7\u5339\u914D\u4E0D\u4E0A\u4E86\uFF0C\u68C0\u67E5\u4E00\u4E0B\u8868\u8FBE\u5F0F\u5427");if(!i.length||i.length===1&&i[0]!==s.X&&Number.isNaN(+i[0]))throw new Error("\u51FD\u6570\u662F\u4E0D\u662F\u5199\u9519\u4E86\u5440\uFF0C\u6211\u600E\u4E48\u89E3\u6790\u4E0D\u4E86\u4E86");const f={raw:e,body:o,node:O(i)};console.log(f),y.emit("process:finish",f)}function H(){y.on("confirm:exp",e=>{try{j(String(e))}catch(r){y.emit("error",r)}})}function N(e,r,o,n){const t=+Number(r===s.X?n:r).toFixed(2),i=+Number(o===s.X?n:o).toFixed(2);let u=0;switch(e){case s.Plus:u=t+i;break;case s.Minus:u=t-i;break;case s.Multiply:u=t*i;break;case s.Divide:case s.Divide2:u=t/i;break;case s.Power:u=t**i;break;case s.Sqrt:u=Math.sqrt(i);break}return u}function v(e,r){const{left:o,right:n,value:t,type:i}=e;return!o&&n&&t===s.Sqrt?n.type==="operator"?N(t,0,v(n,r),r):N(t,0,n.value,r):!o||!n?i==="number"?Number(t):r:o.type!=="operator"&&n.type!=="operator"?N(t,o.value,n.value,r):N(e.value,v(o,r),v(n,r),r)}const m=900,p=800,K="#ddd",c=.5;let E=40;const T={current:null},D={current:null};function $(e){const r=window.devicePixelRatio,o=e?document.createElement("canvas"):document.getElementById("graph"),n=o.getContext("2d");return o.style.width=`${m}px`,o.style.height=`${p}px`,o.width=~~(m*r),o.height=~~(p*r),n.scale(r,r),{canvas:o,ctx:n}}function z(){T.current===null&&(T.current=$());const{ctx:e}=T.current;e.save(),e.translate(m/2,p/2),e.lineWidth=1,e.textAlign="center",e.textBaseline="middle",e.strokeStyle="#333",e.font="14px serif";const r=~~(m/E/2)+2,o=~~(p/E/2)+2,n=B(1,r,"x"),t=B(1,o,"y");let i=0,u=0,f=null;const d=()=>{const{value:a,done:g}=n.next(),{value:x,done:b}=t.next();if(a){const{x:l,label:h}=a;k(e,l+c,-p/2,l+c,p/2),e.beginPath(),e.moveTo(i+c,c),e.lineTo(l+c,c),e.lineTo(l+c,-5+c),e.moveTo(i+c,c),e.lineTo(-(l+c),c),e.lineTo(-(l+c),-5+c),e.fillText(String(h),l,14),e.fillText(String(-h),-l,14),i=l}if(x){const{y:l,label:h}=x;k(e,-m/2,l+c,m/2,l+c),e.beginPath(),e.moveTo(c,u+c),e.lineTo(c,l+c),e.lineTo(5+c,l+c),e.moveTo(c,u+c),e.lineTo(c,-(l+c)),e.lineTo(5+c,-(l+c)),e.fillText(String(-h),-10,l),e.fillText(String(h),-8,-l),u=l}if(e.stroke(),g&&b){f&&cancelAnimationFrame(f),f=null,e.restore();return}f=requestAnimationFrame(d)};d()}function k(e,r,o,n,t){const i=r===n?"-":"",u=o===t?"-":"";e.save(),e.strokeStyle=K,e.beginPath(),e.moveTo(r,o),e.lineTo(n,t),e.moveTo(+`${i}${r}`,+`${u}${o}`),e.lineTo(+`${i}${n}`,+`${u}${t}`),e.stroke(),e.restore()}function*B(e,r,o){let n=e;for(;n<r;){const t={x:0,y:0,label:n,[o]:n*E};n++,yield t}}function J(){D.current===null&&(D.current=$(!0),D.current.ctx.drawImage(T.current.canvas,0,0,m,p));const{ctx:e}=T.current;return e.clearRect(0,0,m,p),e.drawImage(D.current.canvas,0,0,m,p),(...r)=>{const[o,n]=r;let[[t,i],...u]=o;e.save(),e.translate(m/2,p/2),e.strokeStyle="#1B9CFC",e.lineWidth=2,e.beginPath(),e.moveTo(t,-i),u.forEach(([f,d])=>{e.lineTo(f,-d)}),n.length&&([[t,i],...u]=n,e.moveTo(t,-i),u.forEach(([f,d])=>{e.lineTo(f,-d)})),e.stroke(),e.restore()}}function Q(){z(),y.on("process:finish",e=>{const r=J(),o=e.node,n=Number.isFinite(v(o,0)),t=v(o,1),i=v(o,-1),u=t===i,f=!u&&Math.abs(t)===Math.abs(i);let d=null,a=n?0:.1,g=n?0:-.1;const x=()=>{const b=[],l=[];let h=0,F=0,L=0,S=0;for(let M=0;M<5;M++){if(h=Number((a*E).toFixed(2)),F=Number((v(o,a)*E).toFixed(2)),b.push([h,F]),u||f?u?l.push([-h,F]):l.push([-h,-F]):(L=Number((g*E).toFixed(2)),S=Number((v(o,g)*E).toFixed(2)),l.push([L,S])),a>1&&(a>12||F>p/2||S<-p/2)){r(b,l),d&&cancelAnimationFrame(d),d=null;return}a+=.1,g-=.1}a-=.1,g+=.1,r(b,l),requestAnimationFrame(x)};x()})}function U(){y.on("error",e=>{const{message:r}=e;alert(r)})}function Z(){Y(),H(),Q(),U()}window.addEventListener("load",()=>{Z()});
